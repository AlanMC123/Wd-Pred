
Step 1: 读取数据并构建四特征...
f:\Codes\Wd-Pred\transformer_prediction.py:72: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  history_map = df.groupby('Username').apply(
Step 2: 构建四输入样本...
Step 3: 构建Transformer神经网络 (Vocab=321)...
Step 4: 开始训练 (Epochs=10, Batch=1024)...
Epoch 1/10





















3505/3505 [==============================] - 48s 13ms/step - loss: 1.5526 - output_steps_loss: 1.4825 - output_success_loss: 0.1403 - output_success_accuracy: 0.9632 - val_loss: 1.3489 - val_output_steps_loss: 1.2890 - val_output_success_loss: 0.1197 - val_output_success_accuracy: 0.9642
Epoch 2/10





















3505/3505 [==============================] - 47s 14ms/step - loss: 1.3580 - output_steps_loss: 1.2976 - output_success_loss: 0.1209 - output_success_accuracy: 0.9640 - val_loss: 1.3485 - val_output_steps_loss: 1.2889 - val_output_success_loss: 0.1192 - val_output_success_accuracy: 0.9643
Epoch 3/10






















3505/3505 [==============================] - 47s 13ms/step - loss: 1.3510 - output_steps_loss: 1.2912 - output_success_loss: 0.1197 - output_success_accuracy: 0.9643 - val_loss: 1.3551 - val_output_steps_loss: 1.2957 - val_output_success_loss: 0.1188 - val_output_success_accuracy: 0.9645
Epoch 4/10





















3505/3505 [==============================] - 48s 14ms/step - loss: 1.3492 - output_steps_loss: 1.2895 - output_success_loss: 0.1194 - output_success_accuracy: 0.9643 - val_loss: 1.3559 - val_output_steps_loss: 1.2965 - val_output_success_loss: 0.1186 - val_output_success_accuracy: 0.9645
Epoch 5/10




















3505/3505 [==============================] - 44s 13ms/step - loss: 1.3485 - output_steps_loss: 1.2889 - output_success_loss: 0.1192 - output_success_accuracy: 0.9644 - val_loss: 1.3608 - val_output_steps_loss: 1.3015 - val_output_success_loss: 0.1186 - val_output_success_accuracy: 0.9645
Epoch 6/10






















3505/3505 [==============================] - 49s 14ms/step - loss: 1.3478 - output_steps_loss: 1.2883 - output_success_loss: 0.1190 - output_success_accuracy: 0.9644 - val_loss: 1.3598 - val_output_steps_loss: 1.3005 - val_output_success_loss: 0.1186 - val_output_success_accuracy: 0.9645
Epoch 7/10




















3505/3505 [==============================] - 44s 13ms/step - loss: 1.3476 - output_steps_loss: 1.2881 - output_success_loss: 0.1190 - output_success_accuracy: 0.9644 - val_loss: 1.3687 - val_output_steps_loss: 1.3094 - val_output_success_loss: 0.1185 - val_output_success_accuracy: 0.9645
Epoch 8/10


















3505/3505 [==============================] - 42s 12ms/step - loss: 1.3471 - output_steps_loss: 1.2877 - output_success_loss: 0.1189 - output_success_accuracy: 0.9644 - val_loss: 1.3703 - val_output_steps_loss: 1.3111 - val_output_success_loss: 0.1185 - val_output_success_accuracy: 0.9645
Epoch 9/10






















3505/3505 [==============================] - 48s 14ms/step - loss: 1.3470 - output_steps_loss: 1.2875 - output_success_loss: 0.1189 - output_success_accuracy: 0.9644 - val_loss: 1.3681 - val_output_steps_loss: 1.3087 - val_output_success_loss: 0.1187 - val_output_success_accuracy: 0.9645
Epoch 10/10






















3505/3505 [==============================] - 50s 14ms/step - loss: 1.3467 - output_steps_loss: 1.2873 - output_success_loss: 0.1189 - output_success_accuracy: 0.9644 - val_loss: 1.3760 - val_output_steps_loss: 1.3166 - val_output_success_loss: 0.1187 - val_output_success_accuracy: 0.9643
✅ Loss曲线已保存至: visualization\Transformer_loss_curve.png
✅ 模型已成功保存到文件夹: Transformer_Model
Step 4: 开始批量预测，显示进度条...


877/877 [==============================] - 5s 5ms/step
========================================
  Transformer模型验证报告 (Validation Report)
========================================
1. 平均步数误差 (MAE)    : 0.9338
2. 均方根误差 (RMSE)     : 1.1474
3. 胜负预测准确率        : 96.435%
4. ROC曲线下面积 (AUC)   : 0.8684
5. 大型误差率 (>1.5步)  : 19.374%
========================================
Step 5: 启动回测验证抽样报告 (样本数=100000, 输出至 output.txt)...
------------------------------------------------------------
User ID    | Bias  | Diff  | Real  | Pred  | Err   | Status
------------------------------------------------------------
96311      | 2.96  | 3.64  | 3    | 2.99  | 0.01  | ✅
872149     | 5.00  | 4.69  | 5    | 5.25  | 0.25  | ✅
362087     | 3.00  | 3.64  | 2    | 3.01  | 1.01  | ⚠️
686986     | 4.56  | 3.93  | 4    | 4.44  | 0.44  | ✅
84662      | 4.32  | 4.69  | 4    | 4.83  | 0.83  | ✅
826097     | 5.00  | 4.17  | 5    | 5.15  | 0.15  | ✅
694365     | 3.89  | 4.56  | 5    | 4.32  | 0.68  | ✅
62075      | 4.42  | 4.19  | 4    | 4.46  | 0.46  | ✅
698177     | 6.00  | 4.00  | 5    | 6.40  | 1.40  | ⚠️
637347     | 4.20  | 4.28  | 2    | 4.37  | 2.37  | ❌
... (其余 99990 条省略)
✅ 抽样报告已成功导出至 outputs/transformer_output.txt 文件。
✅ 预测趋势图已保存至: visualization\Transformer_prediction_trends.png