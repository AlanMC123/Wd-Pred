
Step 1: 读取数据并构建四特征...
Step 2: 构建四输入样本...
f:\Codes\Wd-Pred\transformer_prediction.py:86: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  history_map = df.groupby('Username').apply(
数据集划分：训练集 2770743, 验证集 395820, 测试集 791642
Step 3: 检测到已保存模型 Transformer_Model，尝试加载...
✅ 模型加载成功，跳过训练。
Step 4: 开始批量预测，显示进度条...

194/194 [==============================] - 4s 20ms/step
Step 4: 开始批量预测，显示进度条...



387/387 [==============================] - 8s 20ms/step
========================================
  Transformer模型验证和测试报告
========================================
---- 验证集指标 ----
1. 平均步数误差 (MAE)    : 0.9049
2. 均方根误差 (RMSE)     : 1.1109
3. 胜负预测准确率        : 96.637%
4. ROC曲线下面积 (AUC)   : 0.8658
5. 大型误差率 (>2.0步)  : 6.473%
---- 测试集指标 ----
1. 平均步数误差 (MAE)    : 0.9053
2. 均方根误差 (RMSE)     : 1.1106
3. 胜负预测准确率        : 96.650%
4. ROC曲线下面积 (AUC)   : 0.8678
5. 大型误差率 (>2.0步)  : 6.454%
========================================
Step 5: 启动回测验证抽样报告 (样本数=10000, 输出至 output.txt)...
---------------------------------------------------------------------------
User ID    | Bias  | Diff  | Real  | Pred_Cont | Pred_Disc | Err   | Status
---------------------------------------------------------------------------
855816     | 4.47  | 4.72  | 4    | 4.87     | 5      | 0.87  | ✅
945471     | 5.00  | 4.42  | 7    | 4.89     | 5      | 2.11  | ❌
899960     | 3.97  | 4.72  | 5    | 4.56     | 5      | 0.44  | ✅
786807     | 3.69  | 3.69  | 2    | 3.17     | 3      | 1.17  | ⚠️
162079     | 4.62  | 4.42  | 5    | 4.66     | 5      | 0.34  | ✅
447987     | 3.44  | 3.88  | 2    | 3.14     | 3      | 1.14  | ⚠️
470451     | 3.83  | 4.08  | 3    | 3.47     | 3      | 0.47  | ✅
163610     | 3.69  | 4.63  | 5    | 4.09     | 4      | 0.91  | ✅
319187     | 4.93  | 3.82  | 5    | 4.43     | 4      | 0.57  | ✅
186326     | 3.94  | 4.28  | 6    | 3.92     | 4      | 2.08  | ❌
... (其余 9990 条省略)
✅ 抽样报告已成功导出至 outputs/transformer_output.txt 文件。
✅ 预测趋势图已保存至: visualization\Transformer_prediction_trends.png
Traceback (most recent call last):
  File "f:\Codes\Wd-Pred\transformer_prediction.py", line 754, in <module>
    main()
  File "f:\Codes\Wd-Pred\transformer_prediction.py", line 725, in main
    confusion_matrix_path = plot_confusion_matrix(
  File "f:\Codes\Wd-Pred\transformer_prediction.py", line 429, in plot_confusion_matrix
    sns.heatmap(cm, annot=True, fmt='d', cmap='Blues',
NameError: name 'sns' is not defined
Traceback (most recent call last):
  File "f:\Codes\Wd-Pred\transformer_prediction.py", line 754, in <module>
    main()
  File "f:\Codes\Wd-Pred\transformer_prediction.py", line 725, in main
    confusion_matrix_path = plot_confusion_matrix(
  File "f:\Codes\Wd-Pred\transformer_prediction.py", line 429, in plot_confusion_matrix
    sns.heatmap(cm, annot=True, fmt='d', cmap='Blues',
NameError: name 'sns' is not defined