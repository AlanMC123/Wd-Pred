
Step 1: 读取数据并构建四特征...
Step 2: 构建四输入样本...
f:\Codes\Wd-Pred\transformer_prediction.py:85: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  history_map = df.groupby('Username').apply(
数据集划分：训练集 2770743, 验证集 395820, 测试集 791642
Step 3: 构建Transformer神经网络 (Vocab=321, Layers=2)...
Step 4: 开始训练 (Epochs=10, Batch=2048, Patience=4)...
Epoch 1/10

























1353/1353 [==============================] - 54s 39ms/step - loss: 1.7643 - output_steps_loss: 1.6869 - output_success_loss: 0.1549 - output_success_accuracy: 0.9666 - val_loss: 1.3691 - val_output_steps_loss: 1.3103 - val_output_success_loss: 0.1176 - val_output_success_accuracy: 0.9664
Epoch 2/10























1353/1353 [==============================] - 48s 36ms/step - loss: 1.3249 - output_steps_loss: 1.2661 - output_success_loss: 0.1175 - output_success_accuracy: 0.9669 - val_loss: 1.2963 - val_output_steps_loss: 1.2405 - val_output_success_loss: 0.1117 - val_output_success_accuracy: 0.9673
Epoch 3/10






















1353/1353 [==============================] - 47s 35ms/step - loss: 1.3065 - output_steps_loss: 1.2495 - output_success_loss: 0.1139 - output_success_accuracy: 0.9672 - val_loss: 1.2941 - val_output_steps_loss: 1.2384 - val_output_success_loss: 0.1114 - val_output_success_accuracy: 0.9676
Epoch 4/10






















1353/1353 [==============================] - 47s 35ms/step - loss: 1.3005 - output_steps_loss: 1.2441 - output_success_loss: 0.1128 - output_success_accuracy: 0.9674 - val_loss: 1.3073 - val_output_steps_loss: 1.2516 - val_output_success_loss: 0.1114 - val_output_success_accuracy: 0.9677
Epoch 5/10






















1353/1353 [==============================] - 46s 34ms/step - loss: 1.2968 - output_steps_loss: 1.2408 - output_success_loss: 0.1121 - output_success_accuracy: 0.9676 - val_loss: 1.3103 - val_output_steps_loss: 1.2548 - val_output_success_loss: 0.1110 - val_output_success_accuracy: 0.9678
Epoch 6/10





















1353/1353 [==============================] - 45s 33ms/step - loss: 1.2943 - output_steps_loss: 1.2385 - output_success_loss: 0.1116 - output_success_accuracy: 0.9676 - val_loss: 1.3311 - val_output_steps_loss: 1.2757 - val_output_success_loss: 0.1109 - val_output_success_accuracy: 0.9678
Epoch 7/10






















1353/1353 [==============================] - 46s 34ms/step - loss: 1.2930 - output_steps_loss: 1.2373 - output_success_loss: 0.1114 - output_success_accuracy: 0.9677 - val_loss: 1.3451 - val_output_steps_loss: 1.2896 - val_output_success_loss: 0.1110 - val_output_success_accuracy: 0.9677
✅ Loss曲线已保存至: visualization\Transformer_loss_curve.png
✅ 模型已成功保存到文件夹: Transformer_Model
Step 4: 开始批量预测，显示进度条...

194/194 [==============================] - 3s 15ms/step
Step 4: 开始批量预测，显示进度条...


387/387 [==============================] - 5s 14ms/step
========================================
  Transformer模型验证和测试报告
========================================
---- 验证集指标 ----
1. 平均步数误差 (MAE)    : 0.9073
2. 均方根误差 (RMSE)     : 1.1128
3. 胜负预测准确率        : 96.755%
4. ROC曲线下面积 (AUC)   : 0.8649
5. 大型误差率 (>1.5步)  : 18.186%
---- 测试集指标 ----
1. 平均步数误差 (MAE)    : 0.9077
2. 均方根误差 (RMSE)     : 1.1127
3. 胜负预测准确率        : 96.757%
4. ROC曲线下面积 (AUC)   : 0.8668
5. 大型误差率 (>1.5步)  : 18.127%
========================================
Step 5: 启动回测验证抽样报告 (样本数=10000, 输出至 output.txt)...
------------------------------------------------------------
User ID    | Bias  | Diff  | Real  | Pred  | Err   | Status
------------------------------------------------------------
940764     | 4.36  | 4.72  | 7    | 4.75  | 2.25  | ❌
950921     | 3.93  | 3.96  | 5    | 3.56  | 1.44  | ⚠️
826926     | 4.00  | 4.64  | 5    | 4.45  | 0.55  | ✅
336059     | 3.57  | 4.35  | 6    | 3.81  | 2.19  | ❌
595016     | 4.37  | 4.28  | 2    | 4.31  | 2.31  | ❌
138113     | 3.76  | 3.52  | 6    | 3.10  | 2.90  | ❌
643688     | 3.90  | 4.61  | 4    | 4.29  | 0.29  | ✅
512689     | 4.67  | 4.11  | 3    | 4.39  | 1.39  | ⚠️
361978     | 3.90  | 3.65  | 3    | 3.30  | 0.30  | ✅
936948     | 4.25  | 4.77  | 5    | 4.66  | 0.34  | ✅
... (其余 9990 条省略)
✅ 抽样报告已成功导出至 outputs/transformer_output.txt 文件。
✅ 预测趋势图已保存至: visualization\Transformer_prediction_trends.png