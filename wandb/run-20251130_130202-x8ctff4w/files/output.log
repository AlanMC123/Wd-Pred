Step 1: è¯»å–æ•°æ®å¹¶æ„å»ºå››ç‰¹å¾...
f:\Codes\Wd-Pred\transformer_prediction.py:99: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  history_map = df.groupby('Username').apply(
Step 2: æ„å»ºå››è¾“å…¥æ ·æœ¬...
æ•°æ®é›†åˆ’åˆ†ï¼šè®­ç»ƒé›† 2770743, éªŒè¯é›† 395820, æµ‹è¯•é›† 791642
âœ… æ•°æ®åŠ è½½ä¼˜åŒ–å·²åº”ç”¨ (cache + prefetch)
Step 3: æ„å»ºTransformerç¥ç»ç½‘ç»œ (Vocab=321, Layers=2)...
WARNING:tensorflow:From D:\Python\Python312\Lib\site-packages\keras\src\backend\tensorflow\core.py:232: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

D:\Python\Python312\Lib\site-packages\keras\src\layers\core\embedding.py:97: UserWarning: Argument `input_length` is deprecated. Just remove it.
  warnings.warn(
âœ… æ¨¡å‹ç¼–è¯‘å®Œæˆï¼Œä½¿ç”¨Focal Loss (gamma=2.0, alpha=0.25)
Step 4: å¼€å§‹è®­ç»ƒ (Epochs=15, Batch=2048, Patience=4)...
æç¤º: å½“å‰ä½¿ç”¨CPUè®­ç»ƒï¼Œé€Ÿåº¦å¯èƒ½è¾ƒæ…¢ã€‚å»ºè®®ä½¿ç”¨æ”¯æŒCUDAçš„GPUä»¥è·å¾—æ˜¾è‘—åŠ é€Ÿã€‚
Epoch 1/15
[1m1353/1353[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37m[0m [1m66s[0m 46ms/step - loss: 1.7713 - output_steps_loss: 1.7609 - output_success_accuracy: 0.9664 - output_success_loss: 0.0208 - val_loss: 1.2533 - val_output_steps_loss: 1.2448 - val_output_success_accuracy: 0.9675 - val_output_success_loss: 0.0173
Epoch 2/15
[1m1353/1353[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37m[0m [1m63s[0m 46ms/step - loss: 1.3005 - output_steps_loss: 1.2918 - output_success_accuracy: 0.9624 - output_success_loss: 0.0174 - val_loss: 1.2660 - val_output_steps_loss: 1.2576 - val_output_success_accuracy: 0.9670 - val_output_success_loss: 0.0170
Epoch 3/15
[1m1353/1353[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37m[0m [1m64s[0m 47ms/step - loss: 1.2574 - output_steps_loss: 1.2491 - output_success_accuracy: 0.9616 - output_success_loss: 0.0167 - val_loss: 1.2709 - val_output_steps_loss: 1.2625 - val_output_success_accuracy: 0.9673 - val_output_success_loss: 0.0170
Epoch 4/15
[1m1353/1353[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37m[0m [1m65s[0m 48ms/step - loss: 1.2517 - output_steps_loss: 1.2434 - output_success_accuracy: 0.9616 - output_success_loss: 0.0165 - val_loss: 1.2685 - val_output_steps_loss: 1.2603 - val_output_success_accuracy: 0.9670 - val_output_success_loss: 0.0168
Epoch 5/15
[1m1353/1353[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37m[0m [1m63s[0m 47ms/step - loss: 1.2489 - output_steps_loss: 1.2407 - output_success_accuracy: 0.9617 - output_success_loss: 0.0164 - val_loss: 1.2627 - val_output_steps_loss: 1.2545 - val_output_success_accuracy: 0.9668 - val_output_success_loss: 0.0167
âœ… Lossæ›²çº¿å·²ä¿å­˜è‡³: visualization\Transformer_loss_curve.png

âŒ æ¨¡å‹ä¿å­˜å¤±è´¥: Invalid filepath extension for saving. Please add either a `.keras` extension for the native Keras format (recommended) or a `.h5` extension. Use `model.export(filepath)` if you want to export a SavedModel for use with TFLite/TFServing/etc. Received: filepath=Transformer_Model.

Step 4: å¼€å§‹æ‰¹é‡é¢„æµ‹ï¼Œæ˜¾ç¤ºè¿›åº¦æ¡...
[1m194/194[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37m[0m [1m4s[0m 20ms/step

Step 4: å¼€å§‹æ‰¹é‡é¢„æµ‹ï¼Œæ˜¾ç¤ºè¿›åº¦æ¡...
[1m387/387[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37m[0m [1m7s[0m 19ms/step

========================================
  Transformeræ¨¡å‹éªŒè¯å’Œæµ‹è¯•æŠ¥å‘Š
========================================
---- éªŒè¯é›†æŒ‡æ ‡ ----
1. å¹³å‡æ­¥æ•°è¯¯å·® (MAE)    : 0.9095
2. å‡æ–¹æ ¹è¯¯å·® (RMSE)     : 1.1157
3. èƒœè´Ÿé¢„æµ‹å‡†ç¡®ç‡        : 96.755%
4. ROCæ›²çº¿ä¸‹é¢ç§¯ (AUC)   : 0.8456
5. å¤§å‹è¯¯å·®ç‡ (>1.5æ­¥)  : 18.331%

---- æµ‹è¯•é›†æŒ‡æ ‡ ----
1. å¹³å‡æ­¥æ•°è¯¯å·® (MAE)    : 0.9100
2. å‡æ–¹æ ¹è¯¯å·® (RMSE)     : 1.1154
3. èƒœè´Ÿé¢„æµ‹å‡†ç¡®ç‡        : 96.757%
4. ROCæ›²çº¿ä¸‹é¢ç§¯ (AUC)   : 0.8478
5. å¤§å‹è¯¯å·®ç‡ (>1.5æ­¥)  : 18.271%
========================================


Step 5: å¯åŠ¨å›æµ‹éªŒè¯æŠ½æ ·æŠ¥å‘Š (æ ·æœ¬æ•°=10000, è¾“å‡ºè‡³ output.txt)...
------------------------------------------------------------
User ID    | Bias  | Diff  | Real  | Pred  | Err   | Status
------------------------------------------------------------
606307     | 4.57  | 4.35  | 2    | 4.51  | 2.51  | âŒ
192962     | 4.43  | 4.22  | 6    | 4.24  | 1.76  | âŒ
458294     | 4.00  | 4.60  | 5    | 4.34  | 0.66  | âœ…
345743     | 4.88  | 3.73  | 5    | 4.28  | 0.72  | âœ…
449504     | 5.00  | 4.34  | 5    | 4.89  | 0.11  | âœ…
716888     | 4.42  | 3.87  | 3    | 3.93  | 0.93  | âœ…
936738     | 4.60  | 4.17  | 4    | 4.34  | 0.34  | âœ…
407793     | 1.92  | 4.66  | 3    | 2.30  | 0.70  | âœ…
836785     | 4.69  | 4.08  | 2    | 4.34  | 2.34  | âŒ
807420     | 2.89  | 4.35  | 2    | 3.00  | 1.00  | âš ï¸
... (å…¶ä½™ 9990 æ¡çœç•¥)

âœ… æŠ½æ ·æŠ¥å‘Šå·²æˆåŠŸå¯¼å‡ºè‡³ outputs/transformer_output.txt æ–‡ä»¶ã€‚
âœ… é¢„æµ‹è¶‹åŠ¿å›¾å·²ä¿å­˜è‡³: visualization\Transformer_prediction_trends.png
